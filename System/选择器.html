<head><script type="module">const e=[{key:'world',title:'世界观',desc:'选择故事基调与时代背景',required:!1,options:[{label:'近未来都市',hint:'',wide:!0},{label:'赛博街区',hint:''},{label:'蒸汽时代',hint:''},{label:'古代架空',hint:''},{label:'魔法学院',hint:'',wide:!0},{label:'废土末世',hint:''},{label:'深海都市',hint:''},{label:'现实日常',hint:''}]},{key:'age',title:'年龄',desc:'宿主年龄区间',required:!1,options:[{label:'18-22',hint:''},{label:'23-27',hint:'',wide:!0},{label:'28-33',hint:''},{label:'34-38',hint:'',wide:!0},{label:'39-45',hint:''},{label:'46+',hint:''}]},{key:'gender',title:'宿主性别',desc:'选择宿主性别',required:!1,options:[{label:'男性',hint:''},{label:'女性',hint:''},{label:'其他',hint:'',wide:!0}]},{key:'personality',title:'性格',desc:'性格走向决定互动风格',required:!1,options:[{label:'冷静理性',hint:''},{label:'温柔顺从',hint:'',wide:!0},{label:'强势掌控',hint:''},{label:'好奇贪玩',hint:'',wide:!0},{label:'高冷自律',hint:''},{label:'外冷内热',hint:''},{label:'敏感多思',hint:''},{label:'反差魅惑',hint:'',wide:!0}]},{key:'kink',title:'特殊癖好',desc:'偏好的互动与刺激类型',required:!1,options:[{label:'控制与指令',hint:'',wide:!0},{label:'语言羞辱',hint:''},{label:'奖励式调教',hint:''},{label:'角色扮演',hint:'',wide:!0},{label:'轻度束缚',hint:''},{label:'感官剥夺',hint:''},{label:'边缘控制',hint:'',wide:!0},{label:'偷窥',hint:''},{label:'暴露',hint:''}]},{key:'identity',title:'宿主身份',desc:'社会身份或职业标签',required:!1,options:[{label:'学生',hint:''},{label:'学者',hint:''},{label:'白领',hint:''},{label:'管理层',hint:'',wide:!0},{label:'医护',hint:''},{label:'教师',hint:''},{label:'艺人',hint:''},{label:'模特',hint:'',wide:!0},{label:'自由职业',hint:''},{label:'军警',hint:''},{label:'安保',hint:''},{label:'媒体',hint:''},{label:'公关',hint:'',wide:!0},{label:'宗教',hint:''},{label:'神秘组织',hint:''}]}],t={currentStep:0,selections:{},customInputs:{}};function n(){const n=$('#step-nav');n.empty(),n.append('<div class="nav-title">流程导航</div>'),e.forEach((e,i)=>{const l=t.currentStep===i,s=!!t.selections[e.key],o=$(`\n      <button class="nav-item ${l?'active':''}">\n        <span class="nav-index">${String(i+1).padStart(2,'0')}</span>\n        <span class="nav-text">${e.title}</span>\n        ${s?'<span class="nav-check">✓</span>':''}\n      </button>\n    `);o.on('click',()=>{t.currentStep=i,a()}),n.append(o)});const i=(t.currentStep+1)/e.length*100;n.append(`\n    <div class="nav-progress">\n      <div class="progress-bar"><div class="progress-fill" style="width:${i}%"></div></div>\n      <div class="progress-text">${t.currentStep+1} / ${e.length}</div>\n    </div>\n  `)}function i(e){const n=t.selections[e.key];if(!n)return'';const i=e.options.find(e=>e.label===n);return i?.hint?`${n}（${i.hint}）`:n}function l(){const n=$('#preview-lines');n.empty(),n.append('<div class="preview-line">宿主已选定，开始生成世界观，资料如下：</div>'),e.forEach(e=>{t.selections[e.key]&&n.append(`<div class="preview-line">${e.title}：${i(e)}</div>`)});const l=($('#extra-info').val()||'').trim();l&&n.append(`<div class="preview-line">补充信息：${l}</div>`)}function a(){n(),function(){const n=e[t.currentStep];$('#step-title').text(n.title),$('#step-desc').text(n.desc)}(),function(){const i=e[t.currentStep],s=$('#step-options');s.empty();const o=t.selections[i.key]||'',r=$(`\n    <button class="option skip ${o?'':'selected'}">\n      <div class="opt-label">跳过此项</div>\n      <div class="opt-hint">不设置该属性</div>\n    </button>\n  `);r.on('click',()=>{delete t.selections[i.key],t.customInputs[i.key]='',a()}),s.append(r),i.options.forEach(e=>{const n=o===e.label,l=$(`\n      <button class="option ${e.wide?'wide':''} ${n?'selected':''}">\n        <div class="opt-label">${e.label}</div>\n        <div class="opt-hint">${e.hint}</div>\n      </button>\n    `);l.on('click',()=>{t.selections[i.key]=e.label,t.customInputs[i.key]='',a()}),s.append(l)});const c=o&&!i.options.some(e=>e.label===o),p=t.customInputs[i.key]||'',d=$(`\n    <div class="option custom wide ${c?'selected':''}">\n      <div class="opt-label">自定义</div>\n      <div class="opt-hint">输入更符合你的设定</div>\n      <input class="custom-input" type="text" placeholder="请输入自定义内容" value="${p}" />\n    </div>\n  `);d.find('.custom-input').on('input',function(){const e=$(this).val();t.customInputs[i.key]=e,t.selections[i.key]=e.trim(),n(),l()}),d.on('click',function(e){$(e.target).is('input')||$(this).find('input').trigger('focus')}),s.append(d)}(),l(),function(){const n=0===t.currentStep,i=t.currentStep===e.length-1;$('#btn-prev').prop('disabled',n),$('#btn-next').toggle(!i),$('#btn-generate').toggle(i)}()}function s(){e.forEach(e=>{const n=e.options.map(e=>e.label),i=n[Math.floor(Math.random()*n.length)];t.selections[e.key]=i,t.customInputs[e.key]=''}),t.currentStep=e.length-1,a(),toastr.success('已随机选择并跳转')}function o(){t.selections={},t.customInputs={},t.currentStep=0,$('#extra-info').val(''),$('#fan-work').val(''),$('#fan-role').val(''),$('#fan-extra').val(''),a(),r(),toastr.info('已重置')}function r(){const e=$('#fan-preview-lines');e.empty(),e.append('<div class="preview-line">宿主已选定，开始生成世界观，资料如下：</div>');const t=($('#fan-work').val()||'').trim(),n=($('#fan-role').val()||'').trim(),i=($('#fan-extra').val()||'').trim();t&&e.append(`<div class="preview-line">作品名字：${t}</div>`),n&&e.append(`<div class="preview-line">角色名字：${n}</div>`),i&&e.append(`<div class="preview-line">补充内容：${i}</div>`)}async function c(){const e=($('#fan-role').val()||'').trim(),t=getCharWorldbookNames('current');if(!t.primary)return toastr.warning('当前角色卡未绑定主世界书'),null;const n=function(){const e=($('#fan-work').val()||'').trim(),t=($('#fan-role').val()||'').trim(),n=($('#fan-extra').val()||'').replace(/```/g,'').trim(),i=['```','<同人世界>','标题: 同人世界',`作品: ${e||'未填写'}`,`角色: ${t||'未填写'}`];if(n){const e=n.replace(/\r/g,'').split('\n').map(e=>`  ${e}`).join('\n');i.push('补充: |',e)}else i.push('补充: 无');return i.push('</同人世界>','```'),i.join('\n')}();return await createWorldbookEntries(t.primary,[{name:e,strategy:{type:'constant',keys:[]},position:{type:'before_character_definition',order:100},content:n,enabled:!0,probability:100,recursion:{prevent_incoming:!0,prevent_outgoing:!0,delay_until:null},effect:{sticky:null,cooldown:null,delay:null}}]),e}$(()=>{$('.mode-btn').on('click',function(){const e=$(this).data('mode');$('.mode-btn').removeClass('is-active'),$(this).addClass('is-active'),'normal'===e?($('#normal-mode').show(),$('#fan-mode').hide()):($('#normal-mode').hide(),$('#fan-mode').show())}),$('#btn-prev').on('click',()=>{t.currentStep>0&&(t.currentStep--,a())}),$('#btn-next').on('click',()=>{const n=e[t.currentStep];!n.required||t.selections[n.key]?t.currentStep<e.length-1&&(t.currentStep++,a()):toastr.warning(`请先选择${n.title}`)}),$('#btn-random').on('click',s),$('#btn-reset').on('click',o),$('#btn-generate').on('click',()=>{const n=function(){const n=e.filter(e=>t.selections[e.key]).map(e=>`${e.title}：${i(e)}`),l=($('#extra-info').val()||'').trim();return l&&n.push(`补充信息：${l}`),`宿主已选定，开始生成世界观，资料如下：${n.join('；')}`}();triggerSlash(`/setinput ${n}`),toastr.success('已写入输入框')}),$('#extra-info').on('input',l),$('#fan-work, #fan-role, #fan-extra').on('input',r),$('#btn-fan-expand').on('click',()=>{$('#fan-editor-textarea').val($('#fan-extra').val()),$('#fan-editor-panel').show(),$('#fan-notice-panel').hide(),$('#fan-overlay').addClass('active')}),$('#btn-fan-cancel').on('click',()=>{$('#fan-overlay').removeClass('active')}),$('#btn-fan-apply').on('click',()=>{$('#fan-extra').val($('#fan-editor-textarea').val()),$('#fan-overlay').removeClass('active'),r()}),$('#btn-fan-notice-close').on('click',()=>{$('#fan-overlay').removeClass('active')}),$('#btn-fan-generate').on('click',async()=>{const e=($('#fan-work').val()||'').trim(),t=($('#fan-role').val()||'').trim();if(!e||!t)return void toastr.warning('同人模式需填写作品名字与角色名字');const n=function(){const e=($('#fan-work').val()||'').trim(),t=($('#fan-role').val()||'').trim(),n=($('#fan-extra').val()||'').trim(),i=[`作品名字：${e}`,`角色名字：${t}`];return n&&i.push(`补充内容：${n}`),`宿主已选定，开始生成世界观，资料如下：${i.join('；')}`}();triggerSlash(`/setinput ${n}`),toastr.success('已写入输入框');try{const e=await c();e&&($('#fan-notice-text').text(`已创建世界书条目：${e}。该条目不会自动删除，如不需要请手动删除。`),$('#fan-editor-panel').hide(),$('#fan-notice-panel').show(),$('#fan-overlay').addClass('active'))}catch(e){console.error(e),toastr.error('创建世界书条目失败')}}),a(),r()});
//# sourceMappingURL=index.js.map</script><style>:root{--bg-paper:#f0f0f0;--bg-window:#e2e2e2;--bg-panel:#f7f7f7;--bg-inset:#dcdcdc;--ink:#0c0c0c;--ink-soft:#2b2b2b;--ink-dim:#6a6a6a;--border:#000000;--border-light:#ffffff;--shadow-hard:2px 2px 0 #000000;--shadow-soft:1px 1px 0 #000000;--accent-rainbow:linear-gradient(90deg,#ff3b30,#ff9500,#ffcc00,#34c759,#5ac8fa,#007aff,#5856d6);--font-ui:'Chicago','Geneva','Pixelated MS Sans Serif','MS Sans Serif','Courier New',monospace;--font-mono:'Courier New','Chicago',monospace}:root[data-theme=dark]{--bg-paper:#161616;--bg-window:#1e1e1e;--bg-panel:#222222;--bg-inset:#0f0f0f;--ink:#e1e1e1;--ink-soft:#c4c4c4;--ink-dim:#949494;--border:#595959;--border-light:#2a2a2a;--shadow-hard:1px 1px 0 #0a0a0a;--shadow-soft:0 0 0 #000000}*{box-sizing:border-box;margin:0;padding:0}body{font-family:var(--font-ui);background:rgba(0,0,0,0);color:var(--ink);font-size:13px;line-height:1.4}#app{width:100%;max-width:none;padding:10px}.shell{display:flex;flex-direction:column;gap:12px;padding:10px;border:1px solid var(--border);background:linear-gradient(135deg,rgba(0,0,0,0.06),transparent 55%),linear-gradient(0deg,var(--bg-window),var(--bg-paper));box-shadow:var(--shadow-hard)}.toast{position:fixed;top:10px;right:10px;padding:6px 10px;border:1px solid var(--border);background:var(--bg-panel);box-shadow:var(--shadow-soft);font-size:.75rem;display:none;z-index:100}.toast.show{display:block}.top-bar{display:grid;grid-template-columns:1fr;gap:8px;align-items:end;padding:10px 12px;background:var(--bg-panel);border:1px solid var(--border);box-shadow:var(--shadow-soft);position:relative}.top-bar::before{content:"";position:absolute;right:10px;top:8px;width:36px;height:6px;background:var(--accent-rainbow);border:1px solid var(--border)}.title{font-size:1rem;font-weight:700;color:var(--ink)}.subtitle{grid-column:1/-1;font-size:.75rem;color:var(--ink-dim)}.mode-switch{display:flex;gap:8px;flex-wrap:wrap}.btn{border:1px solid var(--border);background:var(--bg-panel);box-shadow:var(--shadow-hard);padding:6px 10px;font-size:.75rem;cursor:pointer;font-family:var(--font-ui);color:var(--ink);transition:transform .1s ease,box-shadow .1s ease,background .2s ease}.btn:active{transform:translate(1px,1px);box-shadow:var(--shadow-soft)}.btn[disabled]{opacity:.5;cursor:not-allowed;pointer-events:none}.btn.confirm{background:var(--bg-inset)}.mode-btn.is-active{background:var(--bg-inset);box-shadow:var(--shadow-hard)}.body{display:grid;grid-template-columns:minmax(160px,220px) minmax(0,1fr);gap:12px;align-items:start}.main{display:flex;flex-direction:column;gap:12px}.nav{display:flex;flex-direction:column;gap:6px;padding:10px;background:var(--bg-panel);border:1px solid var(--border);box-shadow:var(--shadow-soft)}.nav-title{font-size:.75rem;color:var(--ink-soft);letter-spacing:1px;text-transform:uppercase;margin-bottom:4px}.nav-item{display:grid;grid-template-columns:auto 1fr auto;align-items:center;gap:6px;padding:6px 8px;border:1px solid var(--border);background:var(--bg-paper);font-size:.75rem;cursor:pointer;text-align:left;font-family:var(--font-ui);color:var(--ink)}.nav-item.active{background:var(--bg-inset);font-weight:700}.nav-index{font-family:var(--font-mono);font-size:.7rem}.nav-check{font-size:.7rem}.nav-progress{margin-top:10px;display:flex;flex-direction:column;gap:6px}.progress-bar{width:100%;height:4px;background:var(--bg-inset);border:1px solid var(--border)}.progress-fill{height:100%;background:var(--accent-rainbow)}.progress-text{font-size:.7rem;color:var(--ink-dim)}.step-header{padding:10px 12px;border:1px solid var(--border);background:var(--bg-panel);box-shadow:var(--shadow-soft);transform:translateX(4px)}.step-title{font-size:.95rem;font-weight:700;color:var(--ink)}.step-desc{font-size:.75rem;color:var(--ink-dim);margin-top:4px}.options{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:8px}.option{padding:10px;border:1px solid var(--border);background:var(--bg-paper);box-shadow:var(--shadow-soft);text-align:left;cursor:pointer;font-family:var(--font-ui);color:var(--ink);transition:transform .12s ease,box-shadow .12s ease}.option.wide{grid-column:span 2}.option.skip{border-style:dashed;opacity:.7}.option.selected{background:var(--bg-inset);transform:translateX(4px);box-shadow:var(--shadow-hard);opacity:1}.option.custom{display:flex;flex-direction:column;gap:6px}.opt-label{font-size:.85rem;font-weight:700}.opt-hint{font-size:.7rem;color:var(--ink-dim)}.custom-input{width:100%;padding:6px 8px;background:var(--bg-window);border:1px solid var(--border);font-family:var(--font-ui);font-size:.75rem;color:var(--ink)}.preview{margin-left:16px;padding:10px 12px;border:1px solid var(--border);background:var(--bg-panel);box-shadow:var(--shadow-soft)}.preview-title{font-size:.75rem;color:var(--ink-soft);letter-spacing:1px;text-transform:uppercase}.preview-lines{margin-top:6px;display:flex;flex-direction:column;gap:4px;font-family:var(--font-mono);font-size:.75rem;color:var(--ink)}.preview-line::before{content:"> ";color:var(--ink-dim)}.action-panel{display:flex;flex-direction:column;gap:10px}.extra-row{display:flex;flex-direction:column;gap:4px}.extra-row label{font-size:.7rem;color:var(--ink-dim)}.extra-input{width:100%;min-height:60px;padding:6px 8px;background:var(--bg-window);border:1px solid var(--border);font-family:var(--font-ui);font-size:.75rem;color:var(--ink);resize:vertical}.actions{display:flex;gap:8px;justify-content:flex-end;flex-wrap:wrap}.fan-body{display:grid;grid-template-columns:minmax(160px,220px) minmax(0,1fr);gap:12px;align-items:start}.fan-side{display:flex;flex-direction:column;gap:10px}.fan-main{display:flex;flex-direction:column;gap:12px}.fan-box{padding:10px 12px;border:1px solid var(--border);background:var(--bg-panel);box-shadow:var(--shadow-soft)}.fan-panel{padding:10px 12px;border:1px solid var(--border);background:var(--bg-panel);box-shadow:var(--shadow-soft);display:flex;flex-direction:column;gap:8px}.fan-panel-title{font-size:.8rem;font-weight:700;margin-bottom:8px}.fan-fields{display:grid;grid-template-columns:minmax(160px,1fr) minmax(200px,1.4fr);gap:10px;align-items:start}.fan-col{display:flex;flex-direction:column;gap:8px}.fan-row{display:flex;flex-direction:column;gap:4px}.fan-row label{font-size:.7rem;color:var(--ink-dim)}.fan-input,.fan-textarea{width:100%;padding:6px 8px;background:var(--bg-window);border:1px solid var(--border);font-family:var(--font-ui);font-size:.75rem;color:var(--ink)}.fan-textarea{height:160px;resize:vertical}.fan-row-actions{display:flex;justify-content:flex-end;margin-top:4px}.fan-actions{display:flex;gap:8px;justify-content:flex-end;flex-wrap:wrap}.fan-overlay{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;align-items:center;justify-content:center;padding:16px;z-index:1000}.fan-overlay.active{display:flex}.fan-editor{width:min(720px,96%);height:min(500px,90%);background:var(--bg-paper);border:1px solid var(--border);box-shadow:var(--shadow-hard);padding:12px;display:flex;flex-direction:column;gap:8px}.fan-editor.notice{width:min(420px,92%);height:auto;background:var(--bg-panel)}.fan-editor.notice::before{content:"";height:6px;background:var(--accent-rainbow);border:1px solid var(--border)}.fan-editor textarea{flex:1;width:100%;padding:8px;background:var(--bg-window);border:1px solid var(--border);font-family:var(--font-ui);font-size:.8rem;color:var(--ink);resize:none}.fan-editor-title{font-size:.85rem;font-weight:700;color:var(--ink)}.fan-notice{font-size:.8rem;color:var(--ink-soft);line-height:1.5;padding:8px;border:1px solid var(--border);background:var(--bg-window)}@media (max-width:820px){.body,.fan-body{grid-template-columns:1fr}.fan-fields{grid-template-columns:1fr}.options{grid-template-columns:1fr}.option.wide{grid-column:span 1}.step-header{transform:none}.preview{margin-left:0}.fan-row-actions{justify-content:flex-start}}

/*# sourceMappingURL=main.css.map*/</style></head><body><div id="app"><div class="shell"><div class="toast" id="toast"></div><div class="top-bar"><div class="title">宿主选择器</div><div class="subtitle">用于新宿主或开局定制，生成提示词后写入输入框</div><div class="mode-switch"><button class="btn mode-btn is-active" data-mode="normal">普通模式</button> <button class="btn mode-btn" data-mode="fan">同人模式</button></div></div><div id="normal-mode" class="mode-content"><div class="body"><aside class="nav" id="step-nav"></aside><section class="main"><header class="step-header"><div class="step-title" id="step-title"></div><div class="step-desc" id="step-desc"></div></header><div class="options" id="step-options"></div><div class="preview"><div class="preview-title">输出预览</div><div class="preview-lines" id="preview-lines"></div></div><div class="action-panel"><div class="extra-row"><label>补充信息</label> <textarea class="extra-input" id="extra-info" placeholder="可填写额外的宿主设定、背景故事等"></textarea></div><div class="actions"><button class="btn" id="btn-random">一键随机</button> <button class="btn" id="btn-reset">一键重置</button> <button class="btn" id="btn-prev" disabled="disabled">上一步</button> <button class="btn" id="btn-next">下一步</button> <button class="btn confirm" id="btn-generate" style="display:none">生成提示词</button></div></div></section></div></div><div id="fan-mode" class="mode-content" style="display:none"><div class="fan-body"><aside class="fan-side"><div class="fan-box"><div class="preview-title">输出预览</div><div class="preview-lines" id="fan-preview-lines"></div></div></aside><section class="fan-main"><div class="fan-panel"><div class="fan-panel-title">同人资料</div><div class="fan-fields"><div class="fan-col"><div class="fan-row"><label>作品名字</label> <input class="fan-input" id="fan-work" placeholder="例如：作品名"/></div><div class="fan-row"><label>角色名字</label> <input class="fan-input" id="fan-role" placeholder="例如：角色名"/></div></div><div class="fan-col"><div class="fan-row"><label>补充内容</label> <textarea class="fan-textarea" id="fan-extra" placeholder="可填写更多设定、剧情或细节"></textarea><div class="fan-row-actions"><button class="btn fan-expand" id="btn-fan-expand">放大编辑</button></div></div></div></div></div><div class="actions fan-actions"><button class="btn confirm" id="btn-fan-generate">生成提示词</button></div></section></div></div></div><div class="fan-overlay" id="fan-overlay"><div class="fan-editor" id="fan-editor-panel"><div class="fan-editor-title">补充内容（全屏编辑）</div><textarea id="fan-editor-textarea" placeholder="输入更多补充内容"></textarea><div class="fan-actions"><button class="btn" id="btn-fan-cancel">取消</button> <button class="btn confirm" id="btn-fan-apply">完成</button></div></div><div class="fan-editor notice" id="fan-notice-panel" style="display:none"><div class="fan-editor-title">同人条目已创建</div><div class="fan-notice" id="fan-notice-text"></div><div class="fan-actions"><button class="btn confirm" id="btn-fan-notice-close">知道了</button></div></div></div></div></body>
